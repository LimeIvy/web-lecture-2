# ãƒã‚¹ãƒˆã®ä¸€è¦§è¡¨ç¤º

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‹ã‚‰æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ä¸€è¦§è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã®å®Ÿè£…æ–¹æ³•ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®æ¥ç¶š

### 1. APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ç¢ºèª

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® `src/routes/posts.ts` ã§ã€æŠ•ç¨¿ä¸€è¦§ã‚’å–å¾—ã™ã‚‹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ï¼š

```typescript:backend/src/routes/posts.ts
const posts = new Hono()
  .get("/", (c) => {
    const posts = db.prepare("SELECT * FROM posts ORDER BY created_at DESC").all();
    return c.json(posts);
  })
```

ã“ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ `GET http://localhost:8080/posts` ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

### 2. å‹å®šç¾©ã®ç¢ºèª

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã¯ã€`src/types/post.ts` ã§æŠ•ç¨¿ã®å‹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã™ï¼š

```typescript:frontend/src/types/post.ts
export type PostType = {
  id: string;
  content: string;
  created_at: string;
  user: {
    id: string;
    name: string;
    icon: string | null;
  };
};
```

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å‹å®šç¾©ãŒä¸€è‡´ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

### 3. APIå‘¼ã³å‡ºã—ã®å®Ÿè£…

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚’å‘¼ã³å‡ºã™ã«ã¯ã€`fetch` APIã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

#### åŸºæœ¬çš„ãªå®Ÿè£…ä¾‹

```typescript
const fetchPosts = async () => {
  try {
    const response = await fetch("http://localhost:8080/posts");
    if (!response.ok) {
      throw new Error("Failed to fetch posts");
    }
    const data = await response.json();
    return data;
  } catch (error) {
    console.error("Error fetching posts:", error);
    throw error;
  }
};
```

#### Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã®ä½¿ç”¨

`useState` ã¨ `useEffect` ã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒã‚¦ãƒ³ãƒˆæ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼š

```typescript
import { useState, useEffect } from "react";
import type { PostType } from "../types/post";

const PostList = () => {
  const [posts, setPosts] = useState<PostType[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);

  useEffect(() => {
    const fetchPosts = async () => {
      try {
        setLoading(true);
        const response = await fetch("http://localhost:8080/posts");
        if (!response.ok) {
          throw new Error("Failed to fetch posts");
        }
        const data = await response.json();
        setPosts(data);
      } catch (err) {
        setError(err instanceof Error ? err.message : "Unknown error");
      } finally {
        setLoading(false);
      }
    };

    fetchPosts();
  }, []);

  if (loading) return <div>èª­ã¿è¾¼ã¿ä¸­...</div>;
  if (error) return <div>ã‚¨ãƒ©ãƒ¼: {error}</div>;

  return (
    <div>
      {posts.map((post) => (
        <div key={post.id}>{post.content}</div>
      ))}
    </div>
  );
};
```

## ãƒã‚¹ãƒˆã®ä¸€è¦§è¡¨ç¤º

### 1. ãƒ‡ãƒ¼ã‚¿ã®å¤‰æ›

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰è¿”ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿å½¢å¼ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å‹å®šç¾©ã¨ç•°ãªã‚‹å ´åˆã€å¤‰æ›å‡¦ç†ãŒå¿…è¦ã§ã™ã€‚

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼

ç¾åœ¨ã®å®Ÿè£…ã§ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ä»¥ä¸‹ã®å½¢å¼ã§ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¾ã™ï¼š

```json
[
  {
    "id": "1",
    "content": "æŠ•ç¨¿å†…å®¹",
    "created_at": "2024-01-01T00:00:00.000Z",
    "user_id": "user1"
  }
]
```

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§å¿…è¦ãªå½¢å¼

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® `PostType` ã§ã¯ã€ä»¥ä¸‹ã®å½¢å¼ãŒå¿…è¦ã§ã™ï¼š

```typescript
{
  id: string;
  content: string;
  created_at: string;
  user: {
    id: string;
    name: string;
    icon: string | null;
  };
}
```

#### è§£æ±ºæ–¹æ³•: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§å¤‰æ›

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® `posts.ts` ã§ã€JOINã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å«ã‚ã¦è¿”ã™ï¼š

```typescript
const posts = db.prepare(`
  SELECT 
    posts.id,
    posts.content,
    posts.created_at,
    posts.user_id,
    users.name,
    users.icon
  FROM posts 
  LEFT JOIN users ON posts.user_id = users.id 
  ORDER BY posts.created_at DESC
`).all();

return c.json(posts.map((post: any) => ({
  id: post.id,
  content: post.content,
  created_at: post.created_at,
  user: {
    id: post.user_id,
    name: post.name || "",
    icon: post.icon || null,
  }
})));
```

### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

APIå‘¼ã³å‡ºã—æ™‚ã«ã¯ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

- **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼**: ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ããªã„
- **HTTPã‚¨ãƒ©ãƒ¼**: 4xx, 5xxã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰
- **ãƒ‡ãƒ¼ã‚¿å½¢å¼ã‚¨ãƒ©ãƒ¼**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãŒæœŸå¾…ã™ã‚‹å½¢å¼ã§ãªã„

```typescript
try {
  const response = await fetch("http://localhost:8080/posts");
  
  if (!response.ok) {
    if (response.status === 404) {
      throw new Error("æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“");
    } else if (response.status >= 500) {
      throw new Error("ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ");
    } else {
      throw new Error(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${response.status}`);
    }
  }
  
  const data = await response.json();
  // ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
  if (!Array.isArray(data)) {
    throw new Error("ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™");
  }
  
  return data;
} catch (error) {
  if (error instanceof TypeError && error.message.includes("fetch")) {
    throw new Error("ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šã§ãã¾ã›ã‚“");
  }
  throw error;
}
```

### 3. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®è¡¨ç¤º

ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã¯ã€ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™ï¼š

```typescript
const [loading, setLoading] = useState(true);

// ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã®è¡¨ç¤º
if (loading) {
  return (
    <div className="flex items-center justify-center p-8">
      <div className="text-gray-500">èª­ã¿è¾¼ã¿ä¸­...</div>
    </div>
  );
}
```

### 4. æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã®çµ±åˆ

`App.tsx` ã§ã€ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã®ä»£ã‚ã‚Šã«APIã‹ã‚‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼š

```typescript
// å¤‰æ›´å‰
import { mockPosts } from "./mocks/posts";
<Post posts={mockPosts} />

// å¤‰æ›´å¾Œ
const [posts, setPosts] = useState<PostType[]>([]);

useEffect(() => {
  fetchPosts().then(setPosts);
}, []);

<Post posts={posts} />
```

## CORSè¨­å®š

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ`http://localhost:5173`ï¼‰ã‹ã‚‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ`http://localhost:8080`ï¼‰ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã€CORSï¼ˆCross-Origin Resource Sharingï¼‰ã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® `src/index.ts` ã§æ—¢ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ï¼š

```typescript:backend/src/index.ts
app.use(
  "*",
  cors({
    origin: "*",
  })
);
```

ã“ã‚Œã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®ã‚ªãƒªã‚¸ãƒ³ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒè¨±å¯ã•ã‚Œã¾ã™ã€‚

## ä¿®æ­£å¾Œã®ã‚³ãƒ¼ãƒ‰ä¸€è¦§

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€šã˜ã¦å¤‰æ›´ã•ã‚ŒãŸã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

### 1. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰API (`backend/src/routes/posts.ts`)

JOINã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å«ã‚ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ã®å½¢å¼ã«å¤‰æ›ã—ã¦è¿”ã™ï¼š

```typescript
import { Hono } from "hono";
import db from "../db/initial";

const posts = new Hono()
  // ãƒ†ã‚¹ãƒˆç”¨: æŠ•ç¨¿ä¸€è¦§å–å¾—(ãƒ¦ãƒ¼ã‚¶æƒ…å ±ä»˜ã)
  .get("/", (c) => {
    const posts = db.prepare(`
      SELECT 
        posts.id,
        posts.content,
        posts.created_at,
        posts.user_id,
        users.name,
        users.icon
      FROM posts 
      LEFT JOIN users ON posts.user_id = users.id 
      ORDER BY posts.created_at DESC
    `).all();

    return c.json(posts.map((post: any) => ({
      id: post.id,
      content: post.content,
      created_at: post.created_at,
      user: {
        id: post.user_id,
        name: post.name || "",
        icon: post.icon || null,
      }
    })));
  })

export default posts;
```

### 2. Postã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`frontend/src/components/Post.tsx`)

```typescript
import { Link } from "react-router-dom";
import { Heart, MessageCircle, Repeat } from "lucide-react";
import type { PostType } from "../types/post";
import { formatTimeAgo } from "../utils/formatTimeAgo";

type PostProps = {
  posts: PostType[];
};

const Post = ({ posts }: PostProps) => {
  return (
    <div>
      {posts.map((post) => (
        <div
          key={post.id}
          className="flex border-b border-gray-800 p-4 transition-colors hover:bg-gray-900/30"
        >
          {/* ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ */}
          <Link to={`/${post.user.id}`} className="mr-4 flex-shrink-0">
            <div className="h-10 w-10 overflow-hidden rounded-full bg-gray-700">
              {post.user.icon ? (
                <img
                  src={post.user.icon}
                  alt={post.user.name}
                  className="h-full w-full object-cover"
                />
              ) : (
                <div className="flex h-full w-full items-center justify-center text-gray-400">
                  {post.user.name.charAt(0)}
                </div>
              )}
            </div>
          </Link>

          {/* æŠ•ç¨¿ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */}
          <Link
            to={`/${post.user.id}/${post.id}`}
            className="block w-full cursor-pointer"
          >
            <div className="w-full">
              <div className="flex items-center">
                <span className="mr-2 font-bold text-white">
                  {post.user.name}
                </span>
                <span className="text-gray-500">
                  {formatTimeAgo(post.created_at)}
                </span>
              </div>

              <p className="mt-1 whitespace-pre-wrap text-white">
                {post.content}
              </p>

              {/* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ */}
              <div className="mt-3 flex w-full max-w-sm items-center gap-4 text-gray-500 sm:gap-12">
                <button
                  className="flex items-center transition-colors hover:text-blue-500"
                  onClick={(e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log("Comment clicked", post.id);
                  }}
                >
                  <MessageCircle size={18} />
                  <span className="ml-1 text-sm">0</span>
                </button>

                <button
                  className="flex items-center transition-colors hover:text-green-500"
                  onClick={(e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log("Retweet clicked", post.id);
                  }}
                >
                  <Repeat size={18} />
                  <span className="ml-1 text-sm">0</span>
                </button>

                <button
                  className="flex items-center transition-colors hover:text-pink-500"
                  onClick={(e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log("Like clicked", post.id);
                  }}
                >
                  <Heart size={18} />
                  <span className="ml-1 text-sm">0</span>
                </button>
              </div>
            </div>
          </Link>
        </div>
      ))}
    </div>
  );
};

export default Post;
```

### 4. ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ (`frontend/src/mocks/posts.ts`)

```typescript
import type { PostType } from "../types/post";

export const mockPosts: PostType[] = [
  {
    id: "1",
    content:
      "React + TypeScriptã§Xã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä½œæˆä¸­ï¼\nTailwind CSSã§ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã™ã‚‹ã®ãŒæ¥½ã—ã„ ğŸ¨",
    created_at: new Date(Date.now() - 1000 * 60 * 5).toISOString(), // 5åˆ†å‰
    user: {
      id: "user1",
      name: "ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼",
      icon: null,
    },
  },
  {
    id: "2",
    content: "ä»Šæ—¥ã‚‚å…ƒæ°—ã«ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ğŸ’»\næ–°ã—ã„æ©Ÿèƒ½ã‚’å®Ÿè£…ã§ãã¦å¬‰ã—ã„ï¼",
    created_at: new Date(Date.now() - 1000 * 60 * 30).toISOString(), // 30åˆ†å‰
    user: {
      id: "user2",
      name: "ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼",
      icon: null,
    },
  },
  {
    id: "3",
    content:
      "Webé–‹ç™ºã®å‹‰å¼·ä¸­ã§ã™ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚‚å¥¥ãŒæ·±ã„...\næ¯æ—¥å°‘ã—ãšã¤æˆé•·ã—ã¦ã„ããŸã„ã€‚",
    created_at: new Date(Date.now() - 1000 * 60 * 60 * 2).toISOString(), // 2æ™‚é–“å‰
    user: {
      id: "user3",
      name: "ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼åˆå¿ƒè€…",
      icon: null,
    },
  },
  {
    id: "4",
    content: "ã‚³ãƒ¼ãƒ’ãƒ¼é£²ã¿ãªãŒã‚‰ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°â˜•\næœ€é«˜ã®çµ„ã¿åˆã‚ã›",
    created_at: new Date(Date.now() - 1000 * 60 * 60 * 5).toISOString(), // 5æ™‚é–“å‰
    user: {
      id: "user1",
      name: "ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼",
      icon: null,
    },
  },
  {
    id: "5",
    content:
      "Vite + React ã®é–‹ç™ºä½“é¨“ãŒç´ æ™´ã‚‰ã—ã„ï¼\nãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ãŒé€Ÿãã¦é–‹ç™ºåŠ¹ç‡ãŒä¸ŠãŒã‚‹ ğŸš€",
    created_at: new Date(Date.now() - 1000 * 60 * 60 * 24).toISOString(), // 1æ—¥å‰
    user: {
      id: "user2",
      name: "ã‚µãƒ³ãƒ—ãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼",
      icon: null,
    },
  },
];
```
